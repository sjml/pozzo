import{S as t,i as e,s as n,c as a,m as o,t as s,a as r,d as i,e as u,b as l,g as c,f as d,h as $,j as p,k as f,l as m,n as h,o as g,A as y,p as v,q as b,r as P,R as x,u as w,v as S,w as I,L as T,x as A}from"./main-1f341ec6.js";function z(t){let e,n;return e=new w({props:{$$slots:{default:[j]},$$scope:{ctx:t}}}),{c(){a(e.$$.fragment)},m(t,a){o(e,t,a),n=!0},p(t,n){const a={};8195&n&&(a.$$scope={dirty:n,ctx:t}),e.$set(a)},i(t){n||(s(e.$$.fragment,t),n=!0)},o(t){r(e.$$.fragment,t),n=!1},d(t){i(e,t)}}}function G(t){let e,n;return e=new T({props:{loader:"AlbumPage"}}),e.$on("uploaded",t[6]),e.$on("structuralChange",t[7]),e.$on("perusalChangeNeeded",t[8]),{c(){a(e.$$.fragment)},m(t,a){o(e,t,a),n=!0},p:A,i(t){n||(s(e.$$.fragment,t),n=!0)},o(t){r(e.$$.fragment,t),n=!1},d(t){i(e,t)}}}function M(t){let e,n;return e=new T({props:{loader:"PerusalPage",perusalIdentifier:t[12].perusalIdentifier}}),{c(){a(e.$$.fragment)},m(t,a){o(e,t,a),n=!0},p(t,n){const a={};4096&n&&(a.perusalIdentifier=t[12].perusalIdentifier),e.$set(a)},i(t){n||(s(e.$$.fragment,t),n=!0)},o(t){r(e.$$.fragment,t),n=!1},d(t){i(e,t)}}}function j(t){let e,n,u,c;return e=new S({props:{$$slots:{default:[G]},$$scope:{ctx:t}}}),u=new S({props:{path:"/:perusalIdentifier",$$slots:{default:[M,({params:t})=>({12:t}),({params:t})=>t?4096:0]},$$scope:{ctx:t}}}),{c(){a(e.$$.fragment),n=I(),a(u.$$.fragment)},m(t,a){o(e,t,a),l(t,n,a),o(u,t,a),c=!0},p(t,n){const a={};8195&n&&(a.$$scope={dirty:n,ctx:t}),e.$set(a);const o={};12288&n&&(o.$$scope={dirty:n,ctx:t}),u.$set(o)},i(t){c||(s(e.$$.fragment,t),s(u.$$.fragment,t),c=!0)},o(t){r(e.$$.fragment,t),r(u.$$.fragment,t),c=!1},d(t){i(e,t),t&&$(n),i(u,t)}}}function C(t){let e,n,a=t[1]&&z(t);return{c(){a&&a.c(),e=u()},m(t,o){a&&a.m(t,o),l(t,e,o),n=!0},p(t,[n]){t[1]?a?(a.p(t,n),2&n&&s(a,1)):(a=z(t),a.c(),s(a,1),a.m(e.parentNode,e)):a&&(c(),r(a,1,1,(()=>{a=null})),d())},i(t){n||(s(a),n=!0)},o(t){r(a),n=!1},d(t){a&&a.d(t),t&&$(e)}}}function D(t,e){return{id:-1,title:"",slug:"",type:e,isPrivate:!1,hasMap:!1,coverPhoto:null,photoGroups:[{id:-1,description:"",hasMap:!1,ordering:1,photos:t}],highestIndex:-1,description:""}}function E(t,e,n){let a,o,s,r;p(t,f,(t=>n(9,a=t))),p(t,m,(t=>n(1,o=t))),p(t,h,(t=>n(5,s=t))),p(t,g,(t=>n(10,r=t)));var i=this&&this.__awaiter||function(t,e,n,a){return new(n||(n=Promise))((function(o,s){function r(t){try{u(a.next(t))}catch(t){s(t)}}function i(t){try{u(a.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,i)}u((a=a.apply(t,e||[])).next())}))};let{albumSlug:u}=e,{albumType:l=y.Album}=e;function c(t){return i(this,void 0,void 0,(function*(){if(b(f,a=null,a),l==y.Album){const e=yield x(`/album/view/${t}`,{authorize:!0});e.success?(-1===e.data.coverPhoto&&(e.data.coverPhoto=null),b(m,o=e.data,o),b(m,o.type=y.Album,o)):404==e.code?P("/"):console.error(e)}else if(l==y.Tag){const e=yield x("/photo/tagSet",{authorize:!0,method:"POST",params:{tags:[t]}});e.success?(b(m,o=D(e.data,y.Tag),o),b(m,o.isPrivate=!r.dynamicPublic,o),b(m,o.title=`#${t}`,o),b(m,o.slug=t,o),b(m,o.description="",o),b(m,o.hasMap=!0,o)):404==e.code?P("/"):console.error(e)}else if(l==y.Dynamic){const e=yield x(`/dynamic/${t}`,{authorize:!0});e.success?(b(m,o=D(e.data,y.Dynamic),o),b(m,o.isPrivate=!r.dynamicPublic,o),"all"==t?(b(m,o.title="[all]",o),b(m,o.slug="all",o),b(m,o.description="",o)):"unsorted"==t&&(b(m,o.title="[unsorted]",o),b(m,o.slug="unsorted",o),b(m,o.description="",o))):404==e.code?P("/"):console.error(e)}}))}function d(t){return i(this,void 0,void 0,(function*(){null!=t?(b(f,a={currentIdx:-1,currentPhoto:null,currentGroup:null,photoSet:[],nodes:[]},a),t.photoGroups.forEach((t=>{t.description.length>0&&b(f,a.nodes=[...a.nodes,t],a),t.photos.forEach((t=>{b(f,a.nodes=[...a.nodes,t],a),b(f,a.photoSet=[...a.photoSet,t],a)}))}))):b(f,a=null,a)}))}v((()=>{b(f,a=null,a),b(m,o=null,o)}));return t.$$set=t=>{"albumSlug"in t&&n(0,u=t.albumSlug),"albumType"in t&&n(4,l=t.albumType)},t.$$.update=()=>{34&t.$$.dirty&&o&&o.isPrivate&&!s&&P("/"),1&t.$$.dirty&&c(u),2&t.$$.dirty&&d(o)},[u,o,c,d,l,s,()=>c(u),()=>c(u),()=>d(o)]}export default class extends t{constructor(t){super(),e(this,t,E,C,n,{albumSlug:0,albumType:4})}}
