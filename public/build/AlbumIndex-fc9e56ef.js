import{S as t,i as e,s as n,c as a,m as o,t as s,a as r,d as u,e as i,b as l,g as c,f as $,h as d,j as p,k as f,l as m,n as h,o as g,A as y,p as b,q as v,r as x,R as w,u as P,v as S,w as I,L as A,x as T}from"./main-4a895478.js";function G(t){let e,n;return e=new P({props:{$$slots:{default:[C]},$$scope:{ctx:t}}}),{c(){a(e.$$.fragment)},m(t,a){o(e,t,a),n=!0},p(t,n){const a={};8195&n&&(a.$$scope={dirty:n,ctx:t}),e.$set(a)},i(t){n||(s(e.$$.fragment,t),n=!0)},o(t){r(e.$$.fragment,t),n=!1},d(t){u(e,t)}}}function j(t){let e,n;return e=new A({props:{loader:"AlbumPage"}}),e.$on("uploaded",t[6]),e.$on("structuralChange",t[7]),e.$on("perusalChangeNeeded",t[8]),{c(){a(e.$$.fragment)},m(t,a){o(e,t,a),n=!0},p:T,i(t){n||(s(e.$$.fragment,t),n=!0)},o(t){r(e.$$.fragment,t),n=!1},d(t){u(e,t)}}}function z(t){let e,n;return e=new A({props:{loader:"PerusalPage",perusalIdentifier:t[12].perusalIdentifier}}),{c(){a(e.$$.fragment)},m(t,a){o(e,t,a),n=!0},p(t,n){const a={};4096&n&&(a.perusalIdentifier=t[12].perusalIdentifier),e.$set(a)},i(t){n||(s(e.$$.fragment,t),n=!0)},o(t){r(e.$$.fragment,t),n=!1},d(t){u(e,t)}}}function C(t){let e,n,i,c;return e=new S({props:{$$slots:{default:[j]},$$scope:{ctx:t}}}),i=new S({props:{path:"/:perusalIdentifier",$$slots:{default:[z,({params:t})=>({12:t}),({params:t})=>t?4096:0]},$$scope:{ctx:t}}}),{c(){a(e.$$.fragment),n=I(),a(i.$$.fragment)},m(t,a){o(e,t,a),l(t,n,a),o(i,t,a),c=!0},p(t,n){const a={};8195&n&&(a.$$scope={dirty:n,ctx:t}),e.$set(a);const o={};12288&n&&(o.$$scope={dirty:n,ctx:t}),i.$set(o)},i(t){c||(s(e.$$.fragment,t),s(i.$$.fragment,t),c=!0)},o(t){r(e.$$.fragment,t),r(i.$$.fragment,t),c=!1},d(t){u(e,t),t&&d(n),u(i,t)}}}function D(t){let e,n,a=t[1]&&G(t);return{c(){a&&a.c(),e=i()},m(t,o){a&&a.m(t,o),l(t,e,o),n=!0},p(t,[n]){t[1]?a?(a.p(t,n),2&n&&s(a,1)):(a=G(t),a.c(),s(a,1),a.m(e.parentNode,e)):a&&(c(),r(a,1,1,(()=>{a=null})),$())},i(t){n||(s(a),n=!0)},o(t){r(a),n=!1},d(t){a&&a.d(t),t&&d(e)}}}function E(t,e,n){let a,o,s,r;p(t,f,(t=>n(9,a=t))),p(t,m,(t=>n(1,o=t))),p(t,h,(t=>n(5,s=t))),p(t,g,(t=>n(10,r=t)));var u=this&&this.__awaiter||function(t,e,n,a){return new(n||(n=Promise))((function(o,s){function r(t){try{i(a.next(t))}catch(t){s(t)}}function u(t){try{i(a.throw(t))}catch(t){s(t)}}function i(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,u)}i((a=a.apply(t,e||[])).next())}))};let{albumSlug:i}=e,{albumType:l=y.Album}=e;function c(t){return u(this,void 0,void 0,(function*(){if(l==y.Album){const e=yield w(`/album/view/${t}`,{authorize:!0});e.success?(-1===e.data.coverPhoto&&(e.data.coverPhoto=null),v(m,o=e.data,o),v(m,o.type=y.Album,o)):404==e.code?x("/"):console.error(e)}else if(l==y.Dynamic){const e=yield w(`/dynamic/${t}`,{authorize:!0});e.success?(v(m,o={id:-1,title:"",slug:"",type:y.Dynamic,isPrivate:!r.dynamicPublic,hasMap:!1,coverPhoto:null,photoGroups:[{id:-1,description:"",hasMap:!1,ordering:1,photos:e.data}],highestIndex:-1,description:""},o),"all"==t?(v(m,o.title="[all]",o),v(m,o.slug="all",o),v(m,o.description="",o)):"unsorted"==t&&(v(m,o.title="[unsorted]",o),v(m,o.slug="unsorted",o),v(m,o.description="",o))):404==e.code?x("/"):console.error(e)}}))}function $(t){return u(this,void 0,void 0,(function*(){null!=t?(v(f,a={currentIdx:-1,currentPhoto:null,currentGroup:null,photoSet:[],nodes:[]},a),t.photoGroups.forEach((t=>{t.description.length>0&&v(f,a.nodes=[...a.nodes,t],a),t.photos.forEach((t=>{v(f,a.nodes=[...a.nodes,t],a),v(f,a.photoSet=[...a.photoSet,t],a)}))}))):v(f,a=null,a)}))}b((()=>{v(f,a=null,a),v(m,o=null,o)}));return t.$$set=t=>{"albumSlug"in t&&n(0,i=t.albumSlug),"albumType"in t&&n(4,l=t.albumType)},t.$$.update=()=>{34&t.$$.dirty&&o&&o.isPrivate&&!s&&x("/"),1&t.$$.dirty&&c(i),2&t.$$.dirty&&$(o)},[i,o,c,$,l,s,()=>c(i),()=>c(i),()=>$(o)]}export default class extends t{constructor(t){super(),e(this,t,E,D,n,{albumSlug:0,albumType:4})}}
